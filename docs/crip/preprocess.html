<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>crip.preprocess API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../crip.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;crip</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#averageProjections">averageProjections</a>
            </li>
            <li>
                    <a class="function" href="#flatDarkFieldCorrection">flatDarkFieldCorrection</a>
            </li>
            <li>
                    <a class="function" href="#projectionsToSinograms">projectionsToSinograms</a>
            </li>
            <li>
                    <a class="function" href="#sinogramsToProjections">sinogramsToProjections</a>
            </li>
            <li>
                    <a class="function" href="#padImage">padImage</a>
            </li>
            <li>
                    <a class="function" href="#padSinogram">padSinogram</a>
            </li>
            <li>
                    <a class="function" href="#correctBeamHardeningPolynomial">correctBeamHardeningPolynomial</a>
            </li>
            <li>
                    <a class="function" href="#injectGaussianNoise">injectGaussianNoise</a>
            </li>
            <li>
                    <a class="function" href="#injectPoissonNoise">injectPoissonNoise</a>
            </li>
            <li>
                    <a class="function" href="#binning">binning</a>
            </li>
            <li>
                    <a class="function" href="#fanToPara">fanToPara</a>
            </li>
            <li>
                    <a class="function" href="#correctRingArtifactInProj">correctRingArtifactInProj</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../crip.html">crip</a><wbr>.preprocess    </h1>

                        <div class="docstring"><p>Preprocess module of crip.</p>

<p><a href="https://github.com/z0gSh1u/crip">https://github.com/z0gSh1u/crip</a></p>
</div>

                        <input id="mod-preprocess-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-preprocess-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="sd">    Preprocess module of crip.</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sd">    https://github.com/z0gSh1u/crip</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a>    <span class="s1">&#39;averageProjections&#39;</span><span class="p">,</span> <span class="s1">&#39;flatDarkFieldCorrection&#39;</span><span class="p">,</span> <span class="s1">&#39;projectionsToSinograms&#39;</span><span class="p">,</span> <span class="s1">&#39;sinogramsToProjections&#39;</span><span class="p">,</span> <span class="s1">&#39;padImage&#39;</span><span class="p">,</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>    <span class="s1">&#39;padSinogram&#39;</span><span class="p">,</span> <span class="s1">&#39;correctBeamHardeningPolynomial&#39;</span><span class="p">,</span> <span class="s1">&#39;injectGaussianNoise&#39;</span><span class="p">,</span> <span class="s1">&#39;injectPoissonNoise&#39;</span><span class="p">,</span> <span class="s1">&#39;binning&#39;</span><span class="p">,</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a>    <span class="s1">&#39;fanToPara&#39;</span><span class="p">,</span> <span class="s1">&#39;correctRingArtifactInProj&#39;</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="p">]</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp2d</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="kn">import</span> <span class="nn">cv2</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="kn">from</span> <span class="nn">.shared</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="kn">from</span> <span class="nn">._typing</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="o">*</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="kn">from</span> <span class="nn">.lowdose</span> <span class="kn">import</span> <span class="n">injectGaussianNoise</span><span class="p">,</span> <span class="n">injectPoissonNoise</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="k">def</span> <span class="nf">averageProjections</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoD</span><span class="p">:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        Average projections. For example, to calculate the flat field.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        Projections can be either `(views, H, W)` shaped numpy array, or</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        `views * (H, W)` Python List.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="s1">&#39;`projections` should be 3D array.&#39;</span><span class="p">)</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>    <span class="n">projections</span> <span class="o">=</span> <span class="n">asFloat</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">projections</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="k">def</span> <span class="nf">flatDarkFieldCorrection</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>                            <span class="n">flat</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">TwoD</span><span class="p">,</span> <span class="n">ThreeD</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>                            <span class="n">dark</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">TwoD</span><span class="p">,</span> <span class="n">ThreeD</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoOrThreeD</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="sd">        Perform flat field (air) and dark field correction to get post-log value.</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="sd">        If `flat` is 3D and `projections` is also 3D, the correction will be performed view by view.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="sd">        I.e., `- log [(X - D) / (F - D)]`. Multi projections accepted.</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a><span class="sd">        If flat is None, air is estimated using the brightest pixel by default.</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>    <span class="n">sampleProjection</span> <span class="o">=</span> <span class="n">projections</span> <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span> <span class="k">else</span> <span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>    <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">flat</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">sampleProjection</span><span class="p">,</span> <span class="n">flat</span><span class="p">),</span> <span class="s1">&#39;`projection` and `flat` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">flat</span><span class="p">):</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">projections</span><span class="p">,</span> <span class="n">flat</span><span class="p">),</span> <span class="s1">&#39;`projection` and `flat` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>    <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">dark</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">sampleProjection</span><span class="p">,</span> <span class="n">dark</span><span class="p">),</span> <span class="s1">&#39;`projection` and `dark` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">dark</span><span class="p">):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">projections</span><span class="p">,</span> <span class="n">dark</span><span class="p">),</span> <span class="s1">&#39;`projection` and `dark` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="k">if</span> <span class="n">flat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>        <span class="n">cripWarning</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;`flat` is None. Use the maximum value instead.&#39;</span><span class="p">)</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        <span class="n">flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">projections</span> <span class="o">-</span> <span class="n">dark</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">-</span> <span class="n">dark</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numerator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Some projections values are not greater than zero.&#39;</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">denominator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Some flat field values are not greater than zero.&#39;</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="k">def</span> <span class="nf">projectionsToSinograms</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">ThreeD</span><span class="p">):</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">        Permute projections to sinograms by axes swapping `(views, h, w) -&gt; (h, views, w)`.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        Note that the width direction is along detector channels of a row.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="s1">&#39;projections should be 3D.&#39;</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    <span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="n">sinograms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="n">sinograms</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">return</span> <span class="n">sinograms</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="k">def</span> <span class="nf">sinogramsToProjections</span><span class="p">(</span><span class="n">sinograms</span><span class="p">:</span> <span class="n">ThreeD</span><span class="p">):</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">        Permute sinograms back to projections by axes swapping `(h, views, w) -&gt; (views, h, w)`.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">        Note that the width direction is along detector channels of a row.</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">sinograms</span><span class="p">),</span> <span class="s1">&#39;projections should be 3D.&#39;</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">sinograms</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">projections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">views</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sinograms</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="n">projections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sinograms</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="k">return</span> <span class="n">projections</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a><span class="k">def</span> <span class="nf">padImage</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>             <span class="n">padding</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>             <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;symmetric&#39;</span><span class="p">,</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>             <span class="n">decay</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a><span class="sd">        Pad the image on four directions using symmetric `padding` (Up, Right, Down, Left). \\</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a><span class="sd">        `mode` determines the border value, can be `symmetric`, `edge`, `constant` (zero), `reflect`. \\</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a><span class="sd">        `decay` can be None, `cosine`, `smoothCosine` to perform a decay on padded border.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;symmetric&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">decay</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;smoothCosine&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Invalid decay: </span><span class="si">{</span><span class="n">decay</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="n">decays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="s1">&#39;cosine&#39;</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">lambda</span> <span class="n">ascend</span><span class="p">,</span> <span class="n">dot</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dot</span><span class="p">)</span> <span class="k">if</span> <span class="n">ascend</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dot</span><span class="p">)),</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="s1">&#39;smoothCosine&#39;</span><span class="p">:</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>            <span class="k">lambda</span> <span class="n">ascend</span><span class="p">,</span> <span class="n">dot</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dot</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>            <span class="k">if</span> <span class="n">ascend</span> <span class="k">else</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dot</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>    <span class="p">}</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">getHW</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>    <span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">,</span> <span class="n">nPadL</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>    <span class="n">padH</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">nPadU</span> <span class="o">+</span> <span class="n">nPadD</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="n">padW</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">nPadL</span> <span class="o">+</span> <span class="n">nPadR</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="k">def</span> <span class="nf">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">decay</span><span class="p">):</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="n">xPad</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">nPadL</span><span class="p">]</span> <span class="o">*=</span> <span class="n">decay</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">)[:]</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="n">xPad</span><span class="p">[:,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">nPadR</span><span class="p">:</span><span class="n">w</span><span class="p">]</span> <span class="o">*=</span> <span class="n">decay</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">)[:]</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="k">return</span> <span class="n">xPad</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>    <span class="k">def</span> <span class="nf">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>        <span class="n">xPad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">((</span><span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">),</span> <span class="p">(</span><span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">decay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="p">,</span> <span class="n">padW</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">decays</span><span class="p">[</span><span class="n">decay</span><span class="p">])</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">padH</span><span class="p">,</span> <span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">,</span> <span class="n">decays</span><span class="p">[</span><span class="n">decay</span><span class="p">])</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">xPad</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">xPad</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="k">return</span> <span class="n">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="k">def</span> <span class="nf">padSinogram</span><span class="p">(</span><span class="n">sgms</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">padding</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="s1">&#39;smoothCosine&#39;</span><span class="p">):</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        Pad sinograms in width direction (same line detector elements) using `mode` and `decay`\\</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        with `padding` (single int, or (right, left)).</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        @see padImage for parameter details.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    <span class="k">if</span> <span class="n">isType</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>    <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>    <span class="k">return</span> <span class="n">padImage</span><span class="p">(</span><span class="n">sgms</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="n">mode</span><span class="p">,</span> <span class="n">decay</span><span class="p">)</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a><span class="k">def</span> <span class="nf">correctBeamHardeningPolynomial</span><span class="p">(</span><span class="n">postlog</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">],</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a><span class="sd">        Apply the polynomial (\\mu L vs. PostLog fit) on postlog to perform basic beam hardening correction.</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a><span class="sd">        `coeffs` can be either `tuple` or `np.poly1d`. Set `bias=True` if your coeffs includes the bias (order 0) term.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="n">cripWarning</span><span class="p">(</span><span class="n">isType</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bias</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;When using np.poly1d as coeffs, bias is always True.&#39;</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="k">if</span> <span class="n">isType</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="o">*</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="k">return</span> <span class="n">coeffs</span><span class="p">(</span><span class="n">postlog</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a><span class="k">def</span> <span class="nf">correctRingArtifactInProj</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ksize</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a><span class="sd">        Apply the ring artifact correction method in projection domain (input postlog sinogram),</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a><span class="sd">        using gaussian filter in sinogram detector direction [1].</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a><span class="sd">        [1] DOI:10.13700/j.bh.1001-5965.2007.11.020.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="n">ksize</span> <span class="o">=</span> <span class="n">ksize</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">getGaussianKernel</span><span class="p">(</span><span class="n">ksize</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>    <span class="k">def</span> <span class="nf">procOne</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoD</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="n">Pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sgm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="n">Rc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">Pc</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="n">Ec</span> <span class="o">=</span> <span class="n">Pc</span> <span class="o">-</span> <span class="n">Rc</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="k">return</span> <span class="n">sgm</span> <span class="o">-</span> <span class="n">Ec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">sgm</span><span class="p">):</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">procOne</span><span class="p">,</span> <span class="n">sgm</span><span class="p">)))</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">procOne</span><span class="p">(</span><span class="n">sgm</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>    <span class="k">return</span> <span class="n">res</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="k">def</span> <span class="nf">fanToPara</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoD</span><span class="p">,</span> <span class="n">gammas</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">betas</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">sid</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">oThetas</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>              <span class="n">oLines</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TwoD</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="sd">        Re-order Fan-Beam sinogram to Parallel-Beam&#39;s.</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">        `gammas`: fan angles from min to max [rad], e.g., `arctan(elementOffcenter / SDD)`</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a><span class="sd">        `betas`: system rotation angles from min to max [rad]</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">        `sid`: Source-Isocenter-Distance [mm]</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">        `oThetas`: output rotation angle range (min, delta, max) tuple [rad]</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">        `oLines`: output detector element physical locations range (min, delta, max) tuple [mm], e.g., `elementOffcenter` array</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">        ```</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">               /| &lt;- gamma for detector element X</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">              / | </span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a><span class="sd">             /  |</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">            /   |</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">           /    |</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">        ---X------------- &lt;- detector</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>    <span class="n">nThetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">oThetas</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    <span class="n">nLines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">oLines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>    <span class="n">thetas1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">oThetas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nThetas</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>    <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">oLines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nLines</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>    <span class="n">thetas</span> <span class="o">=</span> <span class="n">thetas1</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nLines</span><span class="p">))</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    <span class="n">Rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nThetas</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">R1</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>    <span class="n">oGammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">Rs</span> <span class="o">/</span> <span class="n">sid</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    <span class="n">oBetas</span> <span class="o">=</span> <span class="n">thetas</span> <span class="o">+</span> <span class="n">oGammas</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    <span class="n">minBetas</span><span class="p">,</span> <span class="n">maxBetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">betas</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">betas</span><span class="p">)</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>    <span class="n">inds</span> <span class="o">=</span> <span class="n">oBetas</span> <span class="o">&gt;</span> <span class="n">maxBetas</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>        <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="n">inds</span> <span class="o">=</span> <span class="n">oBetas</span> <span class="o">&lt;</span> <span class="n">minBetas</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>    <span class="n">oBetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">oBetas</span><span class="p">,</span> <span class="n">maxBetas</span><span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>    <span class="n">interpolator</span> <span class="o">=</span> <span class="n">interp2d</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">sgm</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">oGammas</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">oBetas</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">oGammas</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            </section>
                <section id="averageProjections">
                            <input id="averageProjections-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">averageProjections</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">projections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="averageProjections-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#averageProjections"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="averageProjections-27"><a href="#averageProjections-27"><span class="linenos">27</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="averageProjections-28"><a href="#averageProjections-28"><span class="linenos">28</span></a><span class="k">def</span> <span class="nf">averageProjections</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoD</span><span class="p">:</span>
</span><span id="averageProjections-29"><a href="#averageProjections-29"><span class="linenos">29</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="averageProjections-30"><a href="#averageProjections-30"><span class="linenos">30</span></a><span class="sd">        Average projections. For example, to calculate the flat field.</span>
</span><span id="averageProjections-31"><a href="#averageProjections-31"><span class="linenos">31</span></a><span class="sd">        Projections can be either `(views, H, W)` shaped numpy array, or</span>
</span><span id="averageProjections-32"><a href="#averageProjections-32"><span class="linenos">32</span></a><span class="sd">        `views * (H, W)` Python List.</span>
</span><span id="averageProjections-33"><a href="#averageProjections-33"><span class="linenos">33</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="averageProjections-34"><a href="#averageProjections-34"><span class="linenos">34</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="s1">&#39;`projections` should be 3D array.&#39;</span><span class="p">)</span>
</span><span id="averageProjections-35"><a href="#averageProjections-35"><span class="linenos">35</span></a>    <span class="n">projections</span> <span class="o">=</span> <span class="n">asFloat</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
</span><span id="averageProjections-36"><a href="#averageProjections-36"><span class="linenos">36</span></a>
</span><span id="averageProjections-37"><a href="#averageProjections-37"><span class="linenos">37</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">projections</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="averageProjections-38"><a href="#averageProjections-38"><span class="linenos">38</span></a>
</span><span id="averageProjections-39"><a href="#averageProjections-39"><span class="linenos">39</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Average projections. For example, to calculate the flat field.
Projections can be either <code>(views, H, W)</code> shaped numpy array, or
<code>views * (H, W)</code> Python List.</p>
</div>


                </section>
                <section id="flatDarkFieldCorrection">
                            <input id="flatDarkFieldCorrection-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">flatDarkFieldCorrection</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">projections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">flat</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">float</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dark</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="flatDarkFieldCorrection-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#flatDarkFieldCorrection"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="flatDarkFieldCorrection-42"><a href="#flatDarkFieldCorrection-42"><span class="linenos">42</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="flatDarkFieldCorrection-43"><a href="#flatDarkFieldCorrection-43"><span class="linenos">43</span></a><span class="k">def</span> <span class="nf">flatDarkFieldCorrection</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span>
</span><span id="flatDarkFieldCorrection-44"><a href="#flatDarkFieldCorrection-44"><span class="linenos">44</span></a>                            <span class="n">flat</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">TwoD</span><span class="p">,</span> <span class="n">ThreeD</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="flatDarkFieldCorrection-45"><a href="#flatDarkFieldCorrection-45"><span class="linenos">45</span></a>                            <span class="n">dark</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">TwoD</span><span class="p">,</span> <span class="n">ThreeD</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoOrThreeD</span><span class="p">:</span>
</span><span id="flatDarkFieldCorrection-46"><a href="#flatDarkFieldCorrection-46"><span class="linenos">46</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="flatDarkFieldCorrection-47"><a href="#flatDarkFieldCorrection-47"><span class="linenos">47</span></a><span class="sd">        Perform flat field (air) and dark field correction to get post-log value.</span>
</span><span id="flatDarkFieldCorrection-48"><a href="#flatDarkFieldCorrection-48"><span class="linenos">48</span></a><span class="sd">        If `flat` is 3D and `projections` is also 3D, the correction will be performed view by view.</span>
</span><span id="flatDarkFieldCorrection-49"><a href="#flatDarkFieldCorrection-49"><span class="linenos">49</span></a><span class="sd">        I.e., `- log [(X - D) / (F - D)]`. Multi projections accepted.</span>
</span><span id="flatDarkFieldCorrection-50"><a href="#flatDarkFieldCorrection-50"><span class="linenos">50</span></a><span class="sd">        If flat is None, air is estimated using the brightest pixel by default.</span>
</span><span id="flatDarkFieldCorrection-51"><a href="#flatDarkFieldCorrection-51"><span class="linenos">51</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="flatDarkFieldCorrection-52"><a href="#flatDarkFieldCorrection-52"><span class="linenos">52</span></a>    <span class="n">sampleProjection</span> <span class="o">=</span> <span class="n">projections</span> <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span> <span class="k">else</span> <span class="n">projections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="flatDarkFieldCorrection-53"><a href="#flatDarkFieldCorrection-53"><span class="linenos">53</span></a>
</span><span id="flatDarkFieldCorrection-54"><a href="#flatDarkFieldCorrection-54"><span class="linenos">54</span></a>    <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">flat</span><span class="p">):</span>
</span><span id="flatDarkFieldCorrection-55"><a href="#flatDarkFieldCorrection-55"><span class="linenos">55</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">sampleProjection</span><span class="p">,</span> <span class="n">flat</span><span class="p">),</span> <span class="s1">&#39;`projection` and `flat` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-56"><a href="#flatDarkFieldCorrection-56"><span class="linenos">56</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">flat</span><span class="p">):</span>
</span><span id="flatDarkFieldCorrection-57"><a href="#flatDarkFieldCorrection-57"><span class="linenos">57</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">projections</span><span class="p">,</span> <span class="n">flat</span><span class="p">),</span> <span class="s1">&#39;`projection` and `flat` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-58"><a href="#flatDarkFieldCorrection-58"><span class="linenos">58</span></a>    <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">dark</span><span class="p">):</span>
</span><span id="flatDarkFieldCorrection-59"><a href="#flatDarkFieldCorrection-59"><span class="linenos">59</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">sampleProjection</span><span class="p">,</span> <span class="n">dark</span><span class="p">),</span> <span class="s1">&#39;`projection` and `dark` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-60"><a href="#flatDarkFieldCorrection-60"><span class="linenos">60</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">dark</span><span class="p">):</span>
</span><span id="flatDarkFieldCorrection-61"><a href="#flatDarkFieldCorrection-61"><span class="linenos">61</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isOfSameShape</span><span class="p">(</span><span class="n">projections</span><span class="p">,</span> <span class="n">dark</span><span class="p">),</span> <span class="s1">&#39;`projection` and `dark` should have same shape.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-62"><a href="#flatDarkFieldCorrection-62"><span class="linenos">62</span></a>    <span class="k">if</span> <span class="n">flat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="flatDarkFieldCorrection-63"><a href="#flatDarkFieldCorrection-63"><span class="linenos">63</span></a>        <span class="n">cripWarning</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;`flat` is None. Use the maximum value instead.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-64"><a href="#flatDarkFieldCorrection-64"><span class="linenos">64</span></a>        <span class="n">flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-65"><a href="#flatDarkFieldCorrection-65"><span class="linenos">65</span></a>
</span><span id="flatDarkFieldCorrection-66"><a href="#flatDarkFieldCorrection-66"><span class="linenos">66</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">projections</span> <span class="o">-</span> <span class="n">dark</span>
</span><span id="flatDarkFieldCorrection-67"><a href="#flatDarkFieldCorrection-67"><span class="linenos">67</span></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="n">flat</span> <span class="o">-</span> <span class="n">dark</span>
</span><span id="flatDarkFieldCorrection-68"><a href="#flatDarkFieldCorrection-68"><span class="linenos">68</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">numerator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Some projections values are not greater than zero.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-69"><a href="#flatDarkFieldCorrection-69"><span class="linenos">69</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">denominator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Some flat field values are not greater than zero.&#39;</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-70"><a href="#flatDarkFieldCorrection-70"><span class="linenos">70</span></a>
</span><span id="flatDarkFieldCorrection-71"><a href="#flatDarkFieldCorrection-71"><span class="linenos">71</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">)</span>
</span><span id="flatDarkFieldCorrection-72"><a href="#flatDarkFieldCorrection-72"><span class="linenos">72</span></a>    <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="flatDarkFieldCorrection-73"><a href="#flatDarkFieldCorrection-73"><span class="linenos">73</span></a>    <span class="n">res</span><span class="p">[</span><span class="n">res</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="flatDarkFieldCorrection-74"><a href="#flatDarkFieldCorrection-74"><span class="linenos">74</span></a>
</span><span id="flatDarkFieldCorrection-75"><a href="#flatDarkFieldCorrection-75"><span class="linenos">75</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Perform flat field (air) and dark field correction to get post-log value.
If <code>flat</code> is 3D and <code>projections</code> is also 3D, the correction will be performed view by view.
I.e., <code>- log [(X - D) / (F - D)]</code>. Multi projections accepted.
If flat is None, air is estimated using the brightest pixel by default.</p>
</div>


                </section>
                <section id="projectionsToSinograms">
                            <input id="projectionsToSinograms-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">projectionsToSinograms</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">projections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="projectionsToSinograms-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#projectionsToSinograms"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="projectionsToSinograms-78"><a href="#projectionsToSinograms-78"><span class="linenos">78</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="projectionsToSinograms-79"><a href="#projectionsToSinograms-79"><span class="linenos">79</span></a><span class="k">def</span> <span class="nf">projectionsToSinograms</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">ThreeD</span><span class="p">):</span>
</span><span id="projectionsToSinograms-80"><a href="#projectionsToSinograms-80"><span class="linenos">80</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="projectionsToSinograms-81"><a href="#projectionsToSinograms-81"><span class="linenos">81</span></a><span class="sd">        Permute projections to sinograms by axes swapping `(views, h, w) -&gt; (h, views, w)`.</span>
</span><span id="projectionsToSinograms-82"><a href="#projectionsToSinograms-82"><span class="linenos">82</span></a>
</span><span id="projectionsToSinograms-83"><a href="#projectionsToSinograms-83"><span class="linenos">83</span></a><span class="sd">        Note that the width direction is along detector channels of a row.</span>
</span><span id="projectionsToSinograms-84"><a href="#projectionsToSinograms-84"><span class="linenos">84</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="projectionsToSinograms-85"><a href="#projectionsToSinograms-85"><span class="linenos">85</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="s1">&#39;projections should be 3D.&#39;</span><span class="p">)</span>
</span><span id="projectionsToSinograms-86"><a href="#projectionsToSinograms-86"><span class="linenos">86</span></a>
</span><span id="projectionsToSinograms-87"><a href="#projectionsToSinograms-87"><span class="linenos">87</span></a>    <span class="p">(</span><span class="n">views</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">projections</span><span class="o">.</span><span class="n">shape</span>
</span><span id="projectionsToSinograms-88"><a href="#projectionsToSinograms-88"><span class="linenos">88</span></a>    <span class="n">sinograms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">projections</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="projectionsToSinograms-89"><a href="#projectionsToSinograms-89"><span class="linenos">89</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
</span><span id="projectionsToSinograms-90"><a href="#projectionsToSinograms-90"><span class="linenos">90</span></a>        <span class="n">sinograms</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">projections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
</span><span id="projectionsToSinograms-91"><a href="#projectionsToSinograms-91"><span class="linenos">91</span></a>
</span><span id="projectionsToSinograms-92"><a href="#projectionsToSinograms-92"><span class="linenos">92</span></a>    <span class="k">return</span> <span class="n">sinograms</span>
</span></pre></div>


            <div class="docstring"><p>Permute projections to sinograms by axes swapping <code>(views, h, w) -&gt; (h, views, w)</code>.</p>

<p>Note that the width direction is along detector channels of a row.</p>
</div>


                </section>
                <section id="sinogramsToProjections">
                            <input id="sinogramsToProjections-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">sinogramsToProjections</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sinograms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sinogramsToProjections-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sinogramsToProjections"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sinogramsToProjections-95"><a href="#sinogramsToProjections-95"><span class="linenos"> 95</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="sinogramsToProjections-96"><a href="#sinogramsToProjections-96"><span class="linenos"> 96</span></a><span class="k">def</span> <span class="nf">sinogramsToProjections</span><span class="p">(</span><span class="n">sinograms</span><span class="p">:</span> <span class="n">ThreeD</span><span class="p">):</span>
</span><span id="sinogramsToProjections-97"><a href="#sinogramsToProjections-97"><span class="linenos"> 97</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="sinogramsToProjections-98"><a href="#sinogramsToProjections-98"><span class="linenos"> 98</span></a><span class="sd">        Permute sinograms back to projections by axes swapping `(h, views, w) -&gt; (views, h, w)`.</span>
</span><span id="sinogramsToProjections-99"><a href="#sinogramsToProjections-99"><span class="linenos"> 99</span></a>
</span><span id="sinogramsToProjections-100"><a href="#sinogramsToProjections-100"><span class="linenos">100</span></a><span class="sd">        Note that the width direction is along detector channels of a row.</span>
</span><span id="sinogramsToProjections-101"><a href="#sinogramsToProjections-101"><span class="linenos">101</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="sinogramsToProjections-102"><a href="#sinogramsToProjections-102"><span class="linenos">102</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is3D</span><span class="p">(</span><span class="n">sinograms</span><span class="p">),</span> <span class="s1">&#39;projections should be 3D.&#39;</span><span class="p">)</span>
</span><span id="sinogramsToProjections-103"><a href="#sinogramsToProjections-103"><span class="linenos">103</span></a>
</span><span id="sinogramsToProjections-104"><a href="#sinogramsToProjections-104"><span class="linenos">104</span></a>    <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">views</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">=</span> <span class="n">sinograms</span><span class="o">.</span><span class="n">shape</span>
</span><span id="sinogramsToProjections-105"><a href="#sinogramsToProjections-105"><span class="linenos">105</span></a>    <span class="n">projections</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">views</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">sinograms</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="sinogramsToProjections-106"><a href="#sinogramsToProjections-106"><span class="linenos">106</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
</span><span id="sinogramsToProjections-107"><a href="#sinogramsToProjections-107"><span class="linenos">107</span></a>        <span class="n">projections</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">sinograms</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="sinogramsToProjections-108"><a href="#sinogramsToProjections-108"><span class="linenos">108</span></a>
</span><span id="sinogramsToProjections-109"><a href="#sinogramsToProjections-109"><span class="linenos">109</span></a>    <span class="k">return</span> <span class="n">projections</span>
</span></pre></div>


            <div class="docstring"><p>Permute sinograms back to projections by axes swapping <code>(h, views, w) -&gt; (views, h, w)</code>.</p>

<p>Note that the width direction is along detector channels of a row.</p>
</div>


                </section>
                <section id="padImage">
                            <input id="padImage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">padImage</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">padding</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;symmetric&#39;</span>,</span><span class="param">	<span class="n">decay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="padImage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#padImage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="padImage-112"><a href="#padImage-112"><span class="linenos">112</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="padImage-113"><a href="#padImage-113"><span class="linenos">113</span></a><span class="k">def</span> <span class="nf">padImage</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span>
</span><span id="padImage-114"><a href="#padImage-114"><span class="linenos">114</span></a>             <span class="n">padding</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
</span><span id="padImage-115"><a href="#padImage-115"><span class="linenos">115</span></a>             <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;symmetric&#39;</span><span class="p">,</span>
</span><span id="padImage-116"><a href="#padImage-116"><span class="linenos">116</span></a>             <span class="n">decay</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="padImage-117"><a href="#padImage-117"><span class="linenos">117</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="padImage-118"><a href="#padImage-118"><span class="linenos">118</span></a><span class="sd">        Pad the image on four directions using symmetric `padding` (Up, Right, Down, Left). \\</span>
</span><span id="padImage-119"><a href="#padImage-119"><span class="linenos">119</span></a><span class="sd">        `mode` determines the border value, can be `symmetric`, `edge`, `constant` (zero), `reflect`. \\</span>
</span><span id="padImage-120"><a href="#padImage-120"><span class="linenos">120</span></a><span class="sd">        `decay` can be None, `cosine`, `smoothCosine` to perform a decay on padded border.</span>
</span><span id="padImage-121"><a href="#padImage-121"><span class="linenos">121</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="padImage-122"><a href="#padImage-122"><span class="linenos">122</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;symmetric&#39;</span><span class="p">,</span> <span class="s1">&#39;edge&#39;</span><span class="p">,</span> <span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Invalid mode: </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="padImage-123"><a href="#padImage-123"><span class="linenos">123</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">decay</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;smoothCosine&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Invalid decay: </span><span class="si">{</span><span class="n">decay</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="padImage-124"><a href="#padImage-124"><span class="linenos">124</span></a>
</span><span id="padImage-125"><a href="#padImage-125"><span class="linenos">125</span></a>    <span class="n">decays</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="padImage-126"><a href="#padImage-126"><span class="linenos">126</span></a>        <span class="s1">&#39;cosine&#39;</span><span class="p">:</span>
</span><span id="padImage-127"><a href="#padImage-127"><span class="linenos">127</span></a>            <span class="k">lambda</span> <span class="n">ascend</span><span class="p">,</span> <span class="n">dot</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dot</span><span class="p">)</span> <span class="k">if</span> <span class="n">ascend</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dot</span><span class="p">)),</span>
</span><span id="padImage-128"><a href="#padImage-128"><span class="linenos">128</span></a>        <span class="s1">&#39;smoothCosine&#39;</span><span class="p">:</span>
</span><span id="padImage-129"><a href="#padImage-129"><span class="linenos">129</span></a>            <span class="k">lambda</span> <span class="n">ascend</span><span class="p">,</span> <span class="n">dot</span><span class="p">:</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dot</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="padImage-130"><a href="#padImage-130"><span class="linenos">130</span></a>            <span class="k">if</span> <span class="n">ascend</span> <span class="k">else</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">dot</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span>
</span><span id="padImage-131"><a href="#padImage-131"><span class="linenos">131</span></a>    <span class="p">}</span>
</span><span id="padImage-132"><a href="#padImage-132"><span class="linenos">132</span></a>
</span><span id="padImage-133"><a href="#padImage-133"><span class="linenos">133</span></a>    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">getHW</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="padImage-134"><a href="#padImage-134"><span class="linenos">134</span></a>    <span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">,</span> <span class="n">nPadL</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="padImage-135"><a href="#padImage-135"><span class="linenos">135</span></a>    <span class="n">padH</span> <span class="o">=</span> <span class="n">h</span> <span class="o">+</span> <span class="n">nPadU</span> <span class="o">+</span> <span class="n">nPadD</span>
</span><span id="padImage-136"><a href="#padImage-136"><span class="linenos">136</span></a>    <span class="n">padW</span> <span class="o">=</span> <span class="n">w</span> <span class="o">+</span> <span class="n">nPadL</span> <span class="o">+</span> <span class="n">nPadR</span>
</span><span id="padImage-137"><a href="#padImage-137"><span class="linenos">137</span></a>
</span><span id="padImage-138"><a href="#padImage-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">decay</span><span class="p">):</span>
</span><span id="padImage-139"><a href="#padImage-139"><span class="linenos">139</span></a>        <span class="n">xPad</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="n">nPadL</span><span class="p">]</span> <span class="o">*=</span> <span class="n">decay</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">)[:]</span>
</span><span id="padImage-140"><a href="#padImage-140"><span class="linenos">140</span></a>        <span class="n">xPad</span><span class="p">[:,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">nPadR</span><span class="p">:</span><span class="n">w</span><span class="p">]</span> <span class="o">*=</span> <span class="n">decay</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">)[:]</span>
</span><span id="padImage-141"><a href="#padImage-141"><span class="linenos">141</span></a>        <span class="k">return</span> <span class="n">xPad</span>
</span><span id="padImage-142"><a href="#padImage-142"><span class="linenos">142</span></a>
</span><span id="padImage-143"><a href="#padImage-143"><span class="linenos">143</span></a>    <span class="k">def</span> <span class="nf">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="padImage-144"><a href="#padImage-144"><span class="linenos">144</span></a>        <span class="n">xPad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="p">((</span><span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">),</span> <span class="p">(</span><span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
</span><span id="padImage-145"><a href="#padImage-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">decay</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="padImage-146"><a href="#padImage-146"><span class="linenos">146</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="p">,</span> <span class="n">padW</span><span class="p">,</span> <span class="n">nPadL</span><span class="p">,</span> <span class="n">nPadR</span><span class="p">,</span> <span class="n">decays</span><span class="p">[</span><span class="n">decay</span><span class="p">])</span>
</span><span id="padImage-147"><a href="#padImage-147"><span class="linenos">147</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">decayLR</span><span class="p">(</span><span class="n">xPad</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">padH</span><span class="p">,</span> <span class="n">nPadU</span><span class="p">,</span> <span class="n">nPadD</span><span class="p">,</span> <span class="n">decays</span><span class="p">[</span><span class="n">decay</span><span class="p">])</span>
</span><span id="padImage-148"><a href="#padImage-148"><span class="linenos">148</span></a>            <span class="n">xPad</span> <span class="o">=</span> <span class="n">xPad</span><span class="o">.</span><span class="n">T</span>
</span><span id="padImage-149"><a href="#padImage-149"><span class="linenos">149</span></a>        <span class="k">return</span> <span class="n">xPad</span>
</span><span id="padImage-150"><a href="#padImage-150"><span class="linenos">150</span></a>
</span><span id="padImage-151"><a href="#padImage-151"><span class="linenos">151</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="padImage-152"><a href="#padImage-152"><span class="linenos">152</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="padImage-153"><a href="#padImage-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="padImage-154"><a href="#padImage-154"><span class="linenos">154</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="padImage-155"><a href="#padImage-155"><span class="linenos">155</span></a>        <span class="k">return</span> <span class="n">procOne</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pad the image on four directions using symmetric <code>padding</code> (Up, Right, Down, Left). \
<code>mode</code> determines the border value, can be <code>symmetric</code>, <code>edge</code>, <code>constant</code> (zero), <code>reflect</code>. \
<code>decay</code> can be None, <code>cosine</code>, <code>smoothCosine</code> to perform a decay on padded border.</p>
</div>


                </section>
                <section id="padSinogram">
                            <input id="padSinogram-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">padSinogram</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sgms</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">padding</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>,</span><span class="param">	<span class="n">mode</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span>,</span><span class="param">	<span class="n">decay</span><span class="o">=</span><span class="s1">&#39;smoothCosine&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="padSinogram-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#padSinogram"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="padSinogram-158"><a href="#padSinogram-158"><span class="linenos">158</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="padSinogram-159"><a href="#padSinogram-159"><span class="linenos">159</span></a><span class="k">def</span> <span class="nf">padSinogram</span><span class="p">(</span><span class="n">sgms</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">padding</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span><span class="p">,</span> <span class="n">decay</span><span class="o">=</span><span class="s1">&#39;smoothCosine&#39;</span><span class="p">):</span>
</span><span id="padSinogram-160"><a href="#padSinogram-160"><span class="linenos">160</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="padSinogram-161"><a href="#padSinogram-161"><span class="linenos">161</span></a><span class="sd">        Pad sinograms in width direction (same line detector elements) using `mode` and `decay`\\</span>
</span><span id="padSinogram-162"><a href="#padSinogram-162"><span class="linenos">162</span></a><span class="sd">        with `padding` (single int, or (right, left)).</span>
</span><span id="padSinogram-163"><a href="#padSinogram-163"><span class="linenos">163</span></a>
</span><span id="padSinogram-164"><a href="#padSinogram-164"><span class="linenos">164</span></a><span class="sd">        @see padImage for parameter details.</span>
</span><span id="padSinogram-165"><a href="#padSinogram-165"><span class="linenos">165</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="padSinogram-166"><a href="#padSinogram-166"><span class="linenos">166</span></a>    <span class="k">if</span> <span class="n">isType</span><span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="padSinogram-167"><a href="#padSinogram-167"><span class="linenos">167</span></a>        <span class="n">padding</span> <span class="o">=</span> <span class="p">(</span><span class="n">padding</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>
</span><span id="padSinogram-168"><a href="#padSinogram-168"><span class="linenos">168</span></a>
</span><span id="padSinogram-169"><a href="#padSinogram-169"><span class="linenos">169</span></a>    <span class="n">l</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">padding</span>
</span><span id="padSinogram-170"><a href="#padSinogram-170"><span class="linenos">170</span></a>
</span><span id="padSinogram-171"><a href="#padSinogram-171"><span class="linenos">171</span></a>    <span class="k">return</span> <span class="n">padImage</span><span class="p">(</span><span class="n">sgms</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">l</span><span class="p">),</span> <span class="n">mode</span><span class="p">,</span> <span class="n">decay</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Pad sinograms in width direction (same line detector elements) using <code>mode</code> and <code>decay</code>\
with <code>padding</code> (single int, or (right, left)).</p>

<p>@see padImage for parameter details.</p>
</div>


                </section>
                <section id="correctBeamHardeningPolynomial">
                            <input id="correctBeamHardeningPolynomial-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">correctBeamHardeningPolynomial</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">postlog</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">coeffs</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">poly1d</span><span class="p">]</span>,</span><span class="param">	<span class="n">bias</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="correctBeamHardeningPolynomial-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#correctBeamHardeningPolynomial"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="correctBeamHardeningPolynomial-174"><a href="#correctBeamHardeningPolynomial-174"><span class="linenos">174</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="correctBeamHardeningPolynomial-175"><a href="#correctBeamHardeningPolynomial-175"><span class="linenos">175</span></a><span class="k">def</span> <span class="nf">correctBeamHardeningPolynomial</span><span class="p">(</span><span class="n">postlog</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">coeffs</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="n">Tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">],</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="correctBeamHardeningPolynomial-176"><a href="#correctBeamHardeningPolynomial-176"><span class="linenos">176</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="correctBeamHardeningPolynomial-177"><a href="#correctBeamHardeningPolynomial-177"><span class="linenos">177</span></a><span class="sd">        Apply the polynomial (\\mu L vs. PostLog fit) on postlog to perform basic beam hardening correction.</span>
</span><span id="correctBeamHardeningPolynomial-178"><a href="#correctBeamHardeningPolynomial-178"><span class="linenos">178</span></a><span class="sd">        `coeffs` can be either `tuple` or `np.poly1d`. Set `bias=True` if your coeffs includes the bias (order 0) term.</span>
</span><span id="correctBeamHardeningPolynomial-179"><a href="#correctBeamHardeningPolynomial-179"><span class="linenos">179</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="correctBeamHardeningPolynomial-180"><a href="#correctBeamHardeningPolynomial-180"><span class="linenos">180</span></a>    <span class="n">cripWarning</span><span class="p">(</span><span class="n">isType</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">)</span> <span class="ow">and</span> <span class="n">bias</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;When using np.poly1d as coeffs, bias is always True.&#39;</span><span class="p">)</span>
</span><span id="correctBeamHardeningPolynomial-181"><a href="#correctBeamHardeningPolynomial-181"><span class="linenos">181</span></a>
</span><span id="correctBeamHardeningPolynomial-182"><a href="#correctBeamHardeningPolynomial-182"><span class="linenos">182</span></a>    <span class="k">if</span> <span class="n">isType</span><span class="p">(</span><span class="n">coeffs</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">):</span>
</span><span id="correctBeamHardeningPolynomial-183"><a href="#correctBeamHardeningPolynomial-183"><span class="linenos">183</span></a>        <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
</span><span id="correctBeamHardeningPolynomial-184"><a href="#correctBeamHardeningPolynomial-184"><span class="linenos">184</span></a>            <span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">poly1d</span><span class="p">([</span><span class="o">*</span><span class="n">coeffs</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="correctBeamHardeningPolynomial-185"><a href="#correctBeamHardeningPolynomial-185"><span class="linenos">185</span></a>
</span><span id="correctBeamHardeningPolynomial-186"><a href="#correctBeamHardeningPolynomial-186"><span class="linenos">186</span></a>    <span class="k">return</span> <span class="n">coeffs</span><span class="p">(</span><span class="n">postlog</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the polynomial (\mu L vs. PostLog fit) on postlog to perform basic beam hardening correction.
<code>coeffs</code> can be either <code>tuple</code> or <code>np.poly1d</code>. Set <code>bias=True</code> if your coeffs includes the bias (order 0) term.</p>
</div>


                </section>
                <section id="injectGaussianNoise">
                            <input id="injectGaussianNoise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">injectGaussianNoise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">projections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="injectGaussianNoise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#injectGaussianNoise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="injectGaussianNoise-16"><a href="#injectGaussianNoise-16"><span class="linenos">16</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="injectGaussianNoise-17"><a href="#injectGaussianNoise-17"><span class="linenos">17</span></a><span class="k">def</span> <span class="nf">injectGaussianNoise</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoOrThreeD</span><span class="p">:</span>
</span><span id="injectGaussianNoise-18"><a href="#injectGaussianNoise-18"><span class="linenos">18</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="injectGaussianNoise-19"><a href="#injectGaussianNoise-19"><span class="linenos">19</span></a><span class="sd">        Inject Gaussian noise which obeys distribution `N(\\mu, \\sigma^2)`.</span>
</span><span id="injectGaussianNoise-20"><a href="#injectGaussianNoise-20"><span class="linenos">20</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="injectGaussianNoise-21"><a href="#injectGaussianNoise-21"><span class="linenos">21</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is2or3D</span><span class="p">(</span><span class="n">projections</span><span class="p">),</span> <span class="s1">&#39;`projections` should be 2D or 3D.&#39;</span><span class="p">)</span>
</span><span id="injectGaussianNoise-22"><a href="#injectGaussianNoise-22"><span class="linenos">22</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">sigma</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sigma should &gt; 0.&#39;</span><span class="p">)</span>
</span><span id="injectGaussianNoise-23"><a href="#injectGaussianNoise-23"><span class="linenos">23</span></a>
</span><span id="injectGaussianNoise-24"><a href="#injectGaussianNoise-24"><span class="linenos">24</span></a>    <span class="n">injectOne</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">img</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="n">img</span>
</span><span id="injectGaussianNoise-25"><a href="#injectGaussianNoise-25"><span class="linenos">25</span></a>
</span><span id="injectGaussianNoise-26"><a href="#injectGaussianNoise-26"><span class="linenos">26</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">projections</span><span class="p">):</span>
</span><span id="injectGaussianNoise-27"><a href="#injectGaussianNoise-27"><span class="linenos">27</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">injectOne</span><span class="p">,</span> <span class="n">projections</span><span class="p">)))</span>
</span><span id="injectGaussianNoise-28"><a href="#injectGaussianNoise-28"><span class="linenos">28</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="injectGaussianNoise-29"><a href="#injectGaussianNoise-29"><span class="linenos">29</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">injectOne</span><span class="p">(</span><span class="n">projections</span><span class="p">)</span>
</span><span id="injectGaussianNoise-30"><a href="#injectGaussianNoise-30"><span class="linenos">30</span></a>
</span><span id="injectGaussianNoise-31"><a href="#injectGaussianNoise-31"><span class="linenos">31</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Inject Gaussian noise which obeys distribution <code>N(\mu, \sigma^2)</code>.</p>
</div>


                </section>
                <section id="injectPoissonNoise">
                            <input id="injectPoissonNoise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">injectPoissonNoise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">projections</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">type_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;postlog&#39;</span>,</span><span class="param">	<span class="n">nPhoton</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="injectPoissonNoise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#injectPoissonNoise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="injectPoissonNoise-34"><a href="#injectPoissonNoise-34"><span class="linenos">34</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="injectPoissonNoise-35"><a href="#injectPoissonNoise-35"><span class="linenos">35</span></a><span class="k">def</span> <span class="nf">injectPoissonNoise</span><span class="p">(</span><span class="n">projections</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">type_</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;postlog&#39;</span><span class="p">,</span> <span class="n">nPhoton</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TwoOrThreeD</span><span class="p">:</span>
</span><span id="injectPoissonNoise-36"><a href="#injectPoissonNoise-36"><span class="linenos">36</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="injectPoissonNoise-37"><a href="#injectPoissonNoise-37"><span class="linenos">37</span></a><span class="sd">        Inject Poisson noise which obeys distribution `P(\\lambda)` where \\lambda is the ground-truth quanta in `projections`.</span>
</span><span id="injectPoissonNoise-38"><a href="#injectPoissonNoise-38"><span class="linenos">38</span></a><span class="sd">        `projections` must have int type whose value stands for the photon quanta in some way. Floating projections</span>
</span><span id="injectPoissonNoise-39"><a href="#injectPoissonNoise-39"><span class="linenos">39</span></a><span class="sd">        should be manually properly rescaled ahead and scale back as you need since Poisson Distribution only deals with</span>
</span><span id="injectPoissonNoise-40"><a href="#injectPoissonNoise-40"><span class="linenos">40</span></a><span class="sd">        positive integers. `type_` (postlog or raw) gives the content type of `projections`, usually you should use</span>
</span><span id="injectPoissonNoise-41"><a href="#injectPoissonNoise-41"><span class="linenos">41</span></a><span class="sd">        postlog as input. If you input postlog, the output will also be postlog.</span>
</span><span id="injectPoissonNoise-42"><a href="#injectPoissonNoise-42"><span class="linenos">42</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="injectPoissonNoise-43"><a href="#injectPoissonNoise-43"><span class="linenos">43</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">type_</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;postlog&#39;</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">],</span> <span class="s2">&quot;type_ should be &#39;postlog&#39; or &#39;raw&#39;.&quot;</span><span class="p">)</span>
</span><span id="injectPoissonNoise-44"><a href="#injectPoissonNoise-44"><span class="linenos">44</span></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">projections</span>
</span><span id="injectPoissonNoise-45"><a href="#injectPoissonNoise-45"><span class="linenos">45</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">is2or3D</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="s1">&#39;`projections` should be 2D or 3D.&#39;</span><span class="p">)</span>
</span><span id="injectPoissonNoise-46"><a href="#injectPoissonNoise-46"><span class="linenos">46</span></a>
</span><span id="injectPoissonNoise-47"><a href="#injectPoissonNoise-47"><span class="linenos">47</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;postlog&#39;</span><span class="p">:</span>
</span><span id="injectPoissonNoise-48"><a href="#injectPoissonNoise-48"><span class="linenos">48</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">projections</span><span class="p">)</span>
</span><span id="injectPoissonNoise-49"><a href="#injectPoissonNoise-49"><span class="linenos">49</span></a>
</span><span id="injectPoissonNoise-50"><a href="#injectPoissonNoise-50"><span class="linenos">50</span></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">img</span> <span class="o">*</span> <span class="n">nPhoton</span>  <span class="c1"># N0 exp(-\sum \mu L)</span>
</span><span id="injectPoissonNoise-51"><a href="#injectPoissonNoise-51"><span class="linenos">51</span></a>
</span><span id="injectPoissonNoise-52"><a href="#injectPoissonNoise-52"><span class="linenos">52</span></a>    <span class="n">cripAssert</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">img</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;`img` should not contain negative values.&#39;</span><span class="p">)</span>
</span><span id="injectPoissonNoise-53"><a href="#injectPoissonNoise-53"><span class="linenos">53</span></a>    <span class="n">cripWarning</span><span class="p">(</span><span class="n">isIntType</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="s1">&#39;`img` should have int dtype. It will be floored after rescaling.&#39;</span><span class="p">)</span>
</span><span id="injectPoissonNoise-54"><a href="#injectPoissonNoise-54"><span class="linenos">54</span></a>
</span><span id="injectPoissonNoise-55"><a href="#injectPoissonNoise-55"><span class="linenos">55</span></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">DefaultFloatDType</span><span class="p">)</span>
</span><span id="injectPoissonNoise-56"><a href="#injectPoissonNoise-56"><span class="linenos">56</span></a>    <span class="n">img</span><span class="p">[</span><span class="n">img</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="injectPoissonNoise-57"><a href="#injectPoissonNoise-57"><span class="linenos">57</span></a>    <span class="n">img</span> <span class="o">/=</span> <span class="n">nPhoton</span>
</span><span id="injectPoissonNoise-58"><a href="#injectPoissonNoise-58"><span class="linenos">58</span></a>
</span><span id="injectPoissonNoise-59"><a href="#injectPoissonNoise-59"><span class="linenos">59</span></a>    <span class="k">if</span> <span class="n">type_</span> <span class="o">==</span> <span class="s1">&#39;postlog&#39;</span><span class="p">:</span>
</span><span id="injectPoissonNoise-60"><a href="#injectPoissonNoise-60"><span class="linenos">60</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
</span><span id="injectPoissonNoise-61"><a href="#injectPoissonNoise-61"><span class="linenos">61</span></a>
</span><span id="injectPoissonNoise-62"><a href="#injectPoissonNoise-62"><span class="linenos">62</span></a>    <span class="k">return</span> <span class="n">img</span>
</span></pre></div>


            <div class="docstring"><p>Inject Poisson noise which obeys distribution <code>P(\lambda)</code> where \lambda is the ground-truth quanta in <code>projections</code>.
<code>projections</code> must have int type whose value stands for the photon quanta in some way. Floating projections
should be manually properly rescaled ahead and scale back as you need since Poisson Distribution only deals with
positive integers. <code>type_</code> (postlog or raw) gives the content type of <code>projections</code>, usually you should use
postlog as input. If you input postlog, the output will also be postlog.</p>
</div>


                </section>
                <section id="binning">
                            <input id="binning-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">binning</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">img</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">rates</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="binning-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#binning"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="binning-155"><a href="#binning-155"><span class="linenos">155</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="binning-156"><a href="#binning-156"><span class="linenos">156</span></a><span class="k">def</span> <span class="nf">binning</span><span class="p">(</span><span class="n">img</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">rates</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TwoOrThreeD</span><span class="p">:</span>
</span><span id="binning-157"><a href="#binning-157"><span class="linenos">157</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="binning-158"><a href="#binning-158"><span class="linenos">158</span></a><span class="sd">        Perform binning with `rates = (c, h, w) / (h, w)`.</span>
</span><span id="binning-159"><a href="#binning-159"><span class="linenos">159</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="binning-160"><a href="#binning-160"><span class="linenos">160</span></a>    <span class="k">for</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">:</span>
</span><span id="binning-161"><a href="#binning-161"><span class="linenos">161</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="n">isInt</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;rates should be positive int.&#39;</span><span class="p">)</span>
</span><span id="binning-162"><a href="#binning-162"><span class="linenos">162</span></a>    <span class="k">if</span> <span class="n">is2D</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="binning-163"><a href="#binning-163"><span class="linenos">163</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;img is 2D, while rates is 3D.&#39;</span><span class="p">)</span>
</span><span id="binning-164"><a href="#binning-164"><span class="linenos">164</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
</span><span id="binning-165"><a href="#binning-165"><span class="linenos">165</span></a>        <span class="n">cripAssert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;img is 3D, while rates is 2D.&#39;</span><span class="p">)</span>
</span><span id="binning-166"><a href="#binning-166"><span class="linenos">166</span></a>
</span><span id="binning-167"><a href="#binning-167"><span class="linenos">167</span></a>    <span class="k">if</span> <span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="binning-168"><a href="#binning-168"><span class="linenos">168</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="binning-169"><a href="#binning-169"><span class="linenos">169</span></a>    <span class="k">if</span> <span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="binning-170"><a href="#binning-170"><span class="linenos">170</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">::</span><span class="n">rates</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">:]</span>
</span><span id="binning-171"><a href="#binning-171"><span class="linenos">171</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">rates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="binning-172"><a href="#binning-172"><span class="linenos">172</span></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="p">[::</span><span class="n">rates</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
</span><span id="binning-173"><a href="#binning-173"><span class="linenos">173</span></a>
</span><span id="binning-174"><a href="#binning-174"><span class="linenos">174</span></a>    <span class="k">return</span> <span class="n">img</span>
</span></pre></div>


            <div class="docstring"><p>Perform binning with <code>rates = (c, h, w) / (h, w)</code>.</p>
</div>


                </section>
                <section id="fanToPara">
                            <input id="fanToPara-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fanToPara</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sgm</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">gammas</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">betas</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>,</span><span class="param">	<span class="n">sid</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">oThetas</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">oLines</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="fanToPara-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#fanToPara"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="fanToPara-213"><a href="#fanToPara-213"><span class="linenos">213</span></a><span class="k">def</span> <span class="nf">fanToPara</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoD</span><span class="p">,</span> <span class="n">gammas</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">betas</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">,</span> <span class="n">sid</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">oThetas</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="fanToPara-214"><a href="#fanToPara-214"><span class="linenos">214</span></a>              <span class="n">oLines</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">TwoD</span><span class="p">:</span>
</span><span id="fanToPara-215"><a href="#fanToPara-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="fanToPara-216"><a href="#fanToPara-216"><span class="linenos">216</span></a><span class="sd">        Re-order Fan-Beam sinogram to Parallel-Beam&#39;s.</span>
</span><span id="fanToPara-217"><a href="#fanToPara-217"><span class="linenos">217</span></a><span class="sd">        `gammas`: fan angles from min to max [rad], e.g., `arctan(elementOffcenter / SDD)`</span>
</span><span id="fanToPara-218"><a href="#fanToPara-218"><span class="linenos">218</span></a><span class="sd">        `betas`: system rotation angles from min to max [rad]</span>
</span><span id="fanToPara-219"><a href="#fanToPara-219"><span class="linenos">219</span></a><span class="sd">        `sid`: Source-Isocenter-Distance [mm]</span>
</span><span id="fanToPara-220"><a href="#fanToPara-220"><span class="linenos">220</span></a><span class="sd">        `oThetas`: output rotation angle range (min, delta, max) tuple [rad]</span>
</span><span id="fanToPara-221"><a href="#fanToPara-221"><span class="linenos">221</span></a><span class="sd">        `oLines`: output detector element physical locations range (min, delta, max) tuple [mm], e.g., `elementOffcenter` array</span>
</span><span id="fanToPara-222"><a href="#fanToPara-222"><span class="linenos">222</span></a><span class="sd">        ```</span>
</span><span id="fanToPara-223"><a href="#fanToPara-223"><span class="linenos">223</span></a><span class="sd">               /| &lt;- gamma for detector element X</span>
</span><span id="fanToPara-224"><a href="#fanToPara-224"><span class="linenos">224</span></a><span class="sd">              / | </span>
</span><span id="fanToPara-225"><a href="#fanToPara-225"><span class="linenos">225</span></a><span class="sd">             /  |</span>
</span><span id="fanToPara-226"><a href="#fanToPara-226"><span class="linenos">226</span></a><span class="sd">            /   |</span>
</span><span id="fanToPara-227"><a href="#fanToPara-227"><span class="linenos">227</span></a><span class="sd">           /    |</span>
</span><span id="fanToPara-228"><a href="#fanToPara-228"><span class="linenos">228</span></a><span class="sd">        ---X------------- &lt;- detector</span>
</span><span id="fanToPara-229"><a href="#fanToPara-229"><span class="linenos">229</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="fanToPara-230"><a href="#fanToPara-230"><span class="linenos">230</span></a>    <span class="n">nThetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">oThetas</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="fanToPara-231"><a href="#fanToPara-231"><span class="linenos">231</span></a>    <span class="n">nLines</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">oLines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="fanToPara-232"><a href="#fanToPara-232"><span class="linenos">232</span></a>
</span><span id="fanToPara-233"><a href="#fanToPara-233"><span class="linenos">233</span></a>    <span class="n">thetas1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">oThetas</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oThetas</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nThetas</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="fanToPara-234"><a href="#fanToPara-234"><span class="linenos">234</span></a>    <span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">oLines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oLines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">nLines</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="fanToPara-235"><a href="#fanToPara-235"><span class="linenos">235</span></a>
</span><span id="fanToPara-236"><a href="#fanToPara-236"><span class="linenos">236</span></a>    <span class="n">thetas</span> <span class="o">=</span> <span class="n">thetas1</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">nLines</span><span class="p">))</span>
</span><span id="fanToPara-237"><a href="#fanToPara-237"><span class="linenos">237</span></a>    <span class="n">Rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">nThetas</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">R1</span>
</span><span id="fanToPara-238"><a href="#fanToPara-238"><span class="linenos">238</span></a>
</span><span id="fanToPara-239"><a href="#fanToPara-239"><span class="linenos">239</span></a>    <span class="n">oGammas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">Rs</span> <span class="o">/</span> <span class="n">sid</span><span class="p">)</span>
</span><span id="fanToPara-240"><a href="#fanToPara-240"><span class="linenos">240</span></a>    <span class="n">oBetas</span> <span class="o">=</span> <span class="n">thetas</span> <span class="o">+</span> <span class="n">oGammas</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="fanToPara-241"><a href="#fanToPara-241"><span class="linenos">241</span></a>
</span><span id="fanToPara-242"><a href="#fanToPara-242"><span class="linenos">242</span></a>    <span class="n">minBetas</span><span class="p">,</span> <span class="n">maxBetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">betas</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">betas</span><span class="p">)</span>
</span><span id="fanToPara-243"><a href="#fanToPara-243"><span class="linenos">243</span></a>    <span class="n">inds</span> <span class="o">=</span> <span class="n">oBetas</span> <span class="o">&gt;</span> <span class="n">maxBetas</span>
</span><span id="fanToPara-244"><a href="#fanToPara-244"><span class="linenos">244</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="fanToPara-245"><a href="#fanToPara-245"><span class="linenos">245</span></a>        <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="fanToPara-246"><a href="#fanToPara-246"><span class="linenos">246</span></a>    <span class="n">inds</span> <span class="o">=</span> <span class="n">oBetas</span> <span class="o">&lt;</span> <span class="n">minBetas</span>
</span><span id="fanToPara-247"><a href="#fanToPara-247"><span class="linenos">247</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="fanToPara-248"><a href="#fanToPara-248"><span class="linenos">248</span></a>        <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">=</span> <span class="n">oBetas</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</span><span id="fanToPara-249"><a href="#fanToPara-249"><span class="linenos">249</span></a>    <span class="n">oBetas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">oBetas</span><span class="p">,</span> <span class="n">maxBetas</span><span class="p">)</span>
</span><span id="fanToPara-250"><a href="#fanToPara-250"><span class="linenos">250</span></a>
</span><span id="fanToPara-251"><a href="#fanToPara-251"><span class="linenos">251</span></a>    <span class="n">interpolator</span> <span class="o">=</span> <span class="n">interp2d</span><span class="p">(</span><span class="n">gammas</span><span class="p">,</span> <span class="n">betas</span><span class="p">,</span> <span class="n">sgm</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="fanToPara-252"><a href="#fanToPara-252"><span class="linenos">252</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">interpolator</span><span class="p">(</span><span class="n">oGammas</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">oBetas</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">oGammas</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="fanToPara-253"><a href="#fanToPara-253"><span class="linenos">253</span></a>
</span><span id="fanToPara-254"><a href="#fanToPara-254"><span class="linenos">254</span></a>    <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Re-order Fan-Beam sinogram to Parallel-Beam's.
<code>gammas</code>: fan angles from min to max [rad], e.g., <code>arctan(elementOffcenter / SDD)</code>
<code>betas</code>: system rotation angles from min to max [rad]
<code>sid</code>: Source-Isocenter-Distance [mm]
<code>oThetas</code>: output rotation angle range (min, delta, max) tuple [rad]
<code>oLines</code>: output detector element physical locations range (min, delta, max) tuple [mm], e.g., <code>elementOffcenter</code> array
```
       /| &lt;- gamma for detector element X
      / | 
     /  |
    /   |
   /    |
---X------------- &lt;- detector</p>
</div>


                </section>
                <section id="correctRingArtifactInProj">
                            <input id="correctRingArtifactInProj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@ConvertListNDArray</div>

        <span class="def">def</span>
        <span class="name">correctRingArtifactInProj</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">sgm</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>,</span><span class="param">	<span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">ksize</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="correctRingArtifactInProj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#correctRingArtifactInProj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="correctRingArtifactInProj-189"><a href="#correctRingArtifactInProj-189"><span class="linenos">189</span></a><span class="nd">@ConvertListNDArray</span>
</span><span id="correctRingArtifactInProj-190"><a href="#correctRingArtifactInProj-190"><span class="linenos">190</span></a><span class="k">def</span> <span class="nf">correctRingArtifactInProj</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoOrThreeD</span><span class="p">,</span> <span class="n">sigma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ksize</span><span class="p">:</span> <span class="n">Or</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="correctRingArtifactInProj-191"><a href="#correctRingArtifactInProj-191"><span class="linenos">191</span></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
</span><span id="correctRingArtifactInProj-192"><a href="#correctRingArtifactInProj-192"><span class="linenos">192</span></a><span class="sd">        Apply the ring artifact correction method in projection domain (input postlog sinogram),</span>
</span><span id="correctRingArtifactInProj-193"><a href="#correctRingArtifactInProj-193"><span class="linenos">193</span></a><span class="sd">        using gaussian filter in sinogram detector direction [1].</span>
</span><span id="correctRingArtifactInProj-194"><a href="#correctRingArtifactInProj-194"><span class="linenos">194</span></a><span class="sd">        [1] DOI:10.13700/j.bh.1001-5965.2007.11.020.</span>
</span><span id="correctRingArtifactInProj-195"><a href="#correctRingArtifactInProj-195"><span class="linenos">195</span></a><span class="sd">    &#39;&#39;&#39;</span>
</span><span id="correctRingArtifactInProj-196"><a href="#correctRingArtifactInProj-196"><span class="linenos">196</span></a>    <span class="n">ksize</span> <span class="o">=</span> <span class="n">ksize</span> <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="correctRingArtifactInProj-197"><a href="#correctRingArtifactInProj-197"><span class="linenos">197</span></a>    <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">getGaussianKernel</span><span class="p">(</span><span class="n">ksize</span><span class="p">,</span> <span class="n">sigma</span><span class="p">))</span>
</span><span id="correctRingArtifactInProj-198"><a href="#correctRingArtifactInProj-198"><span class="linenos">198</span></a>
</span><span id="correctRingArtifactInProj-199"><a href="#correctRingArtifactInProj-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">procOne</span><span class="p">(</span><span class="n">sgm</span><span class="p">:</span> <span class="n">TwoD</span><span class="p">):</span>
</span><span id="correctRingArtifactInProj-200"><a href="#correctRingArtifactInProj-200"><span class="linenos">200</span></a>        <span class="n">Pc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sgm</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="correctRingArtifactInProj-201"><a href="#correctRingArtifactInProj-201"><span class="linenos">201</span></a>        <span class="n">Rc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">Pc</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">)</span>
</span><span id="correctRingArtifactInProj-202"><a href="#correctRingArtifactInProj-202"><span class="linenos">202</span></a>        <span class="n">Ec</span> <span class="o">=</span> <span class="n">Pc</span> <span class="o">-</span> <span class="n">Rc</span>
</span><span id="correctRingArtifactInProj-203"><a href="#correctRingArtifactInProj-203"><span class="linenos">203</span></a>        <span class="k">return</span> <span class="n">sgm</span> <span class="o">-</span> <span class="n">Ec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
</span><span id="correctRingArtifactInProj-204"><a href="#correctRingArtifactInProj-204"><span class="linenos">204</span></a>
</span><span id="correctRingArtifactInProj-205"><a href="#correctRingArtifactInProj-205"><span class="linenos">205</span></a>    <span class="k">if</span> <span class="n">is3D</span><span class="p">(</span><span class="n">sgm</span><span class="p">):</span>
</span><span id="correctRingArtifactInProj-206"><a href="#correctRingArtifactInProj-206"><span class="linenos">206</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">procOne</span><span class="p">,</span> <span class="n">sgm</span><span class="p">)))</span>
</span><span id="correctRingArtifactInProj-207"><a href="#correctRingArtifactInProj-207"><span class="linenos">207</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="correctRingArtifactInProj-208"><a href="#correctRingArtifactInProj-208"><span class="linenos">208</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="n">procOne</span><span class="p">(</span><span class="n">sgm</span><span class="p">)</span>
</span><span id="correctRingArtifactInProj-209"><a href="#correctRingArtifactInProj-209"><span class="linenos">209</span></a>
</span><span id="correctRingArtifactInProj-210"><a href="#correctRingArtifactInProj-210"><span class="linenos">210</span></a>    <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Apply the ring artifact correction method in projection domain (input postlog sinogram),
using gaussian filter in sinogram detector direction [1].
[1] DOI:10.13700/j.bh.1001-5965.2007.11.020.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>